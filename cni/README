# How to test with kubernetes

sudo apt-get install -y curl

curl -L  https://github.com/coreos/etcd/releases/download/v2.2.4/etcd-v2.2.4-linux-amd64.tar.gz -o etcd-v2.2.4-linux-amd64.tar.gz
tar xzvf etcd-v2.2.4-linux-amd64.tar.gz

git clone --depth=1 https://github.com/kubernetes/kubernetes.git
cd kubernetes
sudo -E su
mkdir -p /etc/cni/net.d
mkdir -p /opt/cni
ln -s /home/vagrant/go/src/github.com/noironetworks/cilium-net/cni /opt/cni/bin
ln -s /home/vagrant/go/src/github.com/noironetworks/cilium-net/cni/10-cilium-cni.conf /etc/cni/net.d/10-cilium-cni.conf

export PATH=$PATH:/home/vagrant/etcd-v2.2.4-linux-amd64:/usr/local/go/bin

#apply patch
patch -p1 < /home/vagrant/go/src/github.com/noironetworks/cilium-net/cni/kubernetes.patch

# Run the following command on this terminal
# Make sure all cilium-cni and host-local are built
hack/local-up-cluster.sh

##on a different terminal
cluster/kubectl.sh run my-nginx --image=nginx --port=80
